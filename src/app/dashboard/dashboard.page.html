<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Dashboard</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Dashboard</ion-title>
    </ion-toolbar>
  </ion-header>

  <!-- ======================================================= -->
  <!-- SELETOR DE DATA -->
  <!-- ======================================================= -->
  <ion-item button="true" (click)="abrirModal()">
    <ion-icon name="calendar-outline" slot="start" color="primary"></ion-icon>
    <ion-label>Selecione a Data</ion-label>
    <ion-note slot="end">{{ dataSelecionadaFormatada }}</ion-note>
  </ion-item>

  <!-- ======================================================= -->
  <!-- MODAL DO CALENDÁRIO -->
  <!-- ======================================================= -->
  <ion-modal
    [isOpen]="isModalOpen"
    [initialBreakpoint]="0.6"
    [breakpoints]="[0, 0.6, 0.9]"
    (didDismiss)="cancelarModal()"
  >
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-buttons slot="start">
            <ion-button (click)="cancelarModal()">Cancelar</ion-button>
          </ion-buttons>
          <ion-title>Selecione a Data</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="confirmarData()" [strong]="true">Confirmar</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>

      <ion-content class="ion-padding">
        <ion-datetime
          [value]="tempDataSelecionada"
          (ionChange)="dataMudouTemp($event)"
          presentation="date"
          size="cover"
        ></ion-datetime>
      </ion-content>
    </ng-template>
  </ion-modal>

  <!-- ======================================================= -->
  <!-- GRÁFICO -->
  <!-- ======================================================= -->
  <div *ngIf="lineChartData" class="ion-padding">
    <ion-item-divider>
      <ion-label>Análise do Dia</ion-label>
    </ion-item-divider>

    <canvas
      baseChart
      [data]="lineChartData"
      [options]="lineChartOptions"
      [type]="'line'">
    </canvas>
  </div>

  <!-- ======================================================= -->
  <!-- LISTA DE DADOS -->
  <!-- ======================================================= -->
  <div *ngIf="historicoDoDia && historicoDoDia.length > 0">
    <ion-item-divider>
      <ion-label>Registros do Dia: {{ dataSelecionadaFormatada }}</ion-label>
    </ion-item-divider>

    <ion-list>
      <ion-item *ngFor="let item of historicoDoDia">
        <ion-label>
          <h2>
            <ion-icon name="thermometer-outline" color="danger" class="icon-text"></ion-icon>
            Temperatura: {{ item.temperatura }} °C
          </h2>
          <p>
            <ion-icon name="water-outline" color="primary" class="icon-text"></ion-icon>
            Umidade: {{ item.umidade }} %
          </p>
          <p>
            <ion-icon name="flask-outline" color="success" class="icon-text"></ion-icon>
            PH: {{ item.PH }}
          </p>
          <p class="ion-text-end ion-no-margin">
            <small>
              <ion-icon name="time-outline" class="icon-text"></ion-icon>
              {{ item.timestamp.split(', ')[1] }}
            </small>
          </p>
        </ion-label>
      </ion-item>
    </ion-list>
  </div>

  <!-- ======================================================= -->
  <!-- MENSAGEM QUANDO NÃO HÁ DADOS -->
  <!-- ======================================================= -->
  <div *ngIf="!historicoDoDia || historicoDoDia.length === 0" class="ion-padding ion-text-center">
    <ion-label>Nenhum dado de histórico encontrado para esta data.</ion-label>
  </div>

</ion-content>
